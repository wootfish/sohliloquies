---
layout: post
title: Setting Up Deep Dream, Google Research's Hallucinatory Work of Genius
date: '2015-07-02T03:06:00.000-07:00'
author: Eli Sohl
tags: 
modified_time: '2015-07-24T12:41:45.249-07:00'
blogger_id: tag:blogger.com,1999:blog-4261047698100656327.post-4529442222264344335
blogger_orig_url: http://sohliloquies.blogspot.com/2015/07/setting-up-deep-dream-google-researchs.html
---

Google Research <a href="http://googleresearch.blogspot.ch/2015/06/inceptionism-going-deeper-into-neural.html">wrote</a>&nbsp;recently&nbsp;about a technique they call "Inceptionism", which needs to be seen to be believed. Click through and check out their pictures. A full gallery of official images can be found <a href="https://photos.google.com/share/AF1QipPX0SCl7OzWilt9LnuQliattX4OUCj_8EP65_cTVnBmS1jnYgsGQAieQUc1VQWdgQ?key=aVBxWjhwSzg2RjJWLWRuVFBBZEN1d205bUdEMnhB">here</a>. The techniques used to generate these sorts of images were described in broad strokes in this blog post, but the level of detail stopped just short of what someone wanting to replicate their results might have wanted.<br /><br />That is, until&nbsp;<a href="https://github.com/google/deepdream">they published their source code</a>.<br /><br />In this repo (which was created just this morning, as of this post's writing) is an IPython notebook which contains everything necessary to duplicate the results you see in their blog post. That's so cool that it's honestly a little hard to believe. The dependencies are detailed in the repo. There are surprisingly few of them, and they're all surprisingly easy to get set up. Let me walk you through what I had to do on my Debian Stretch system to get everything up and running.<br /><br /><a name='more'></a>NumPy, SciPy, PIL, and&nbsp;IPython top the list of dependencies. These are all libraries that the savvy Pythonista likely already has installed. Anyone without them should &nbsp;hasten to change this state of affairs. If you have Python's library manager, pip, installed -- and you should -- then the best way to install all these libraries is by invoking,<br /><div><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace;">sudo pip install numpy scipy Pillow ipython</span></blockquote><div><div>You're also going to need "protobuf". This is a Google library, and should be available through your package manager. On Debian,</div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">sudo apt-get install protobuf-compiler</span></blockquote><div>did the trick for me.</div><div><br /></div><div>That takes care of the easy dependencies. Next, we have to install Caffe. This is where I spent most of my time. It turns out that the painless way to handle this whole process is as follows.</div><div><br /></div><div>First off, get Caffe's own prerequisites out of the way. I used the list of <span style="font-family: Courier New, Courier, monospace;">apt-get</span>&nbsp;packages from their&nbsp;<a href="http://caffe.berkeleyvision.org/install_apt.html">Ubuntu</a>&nbsp;install reference. To wit:</div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libboost-all-dev libhdf5-serial-dev libgflags-dev libgoogle-glog-dev liblmdb-dev protobuf-compiler libatlas-base-dev</span></blockquote><div><span style="font-family: inherit;">I've had smooth sailing just installing that list. As ever, YMMV. If anyone finds that they need to install other packages in addition to these, please leave a comment, and I'll amend the list.</span></div><div><span style="font-family: inherit;"><br /></span></div><div><span style="font-family: inherit;">Anyhow, once that's taken care of,&nbsp;</span><span style="font-family: Courier New, Courier, monospace;">cd</span> to whatever directory you want to install Caffe in (I put it in my usual ~/workspace directory), then download the Git repo and configure whatever options you'd like. There are several ways to get the Git repo. First, make sure to&nbsp;<a href="https://help.github.com/articles/set-up-git/">set up Git</a>, and follow the instructions on that page for either connecting over HTTPS or SSH. Then, depending on which of those you set up, run <i>one of the two following commands</i>. If you set up HTTPS, use<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">git clone&nbsp;https://github.com/BVLC/caffe.git</span></blockquote>to clone over HTTPS, or if you set up SSH, then</div></div></div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">git clone git@github.com:BVLC/caffe.git</span>&nbsp;</blockquote>to clone the repo that way. (thanks misterque and Pui for their comments on this section). Once you've run one of these commands, which will create a new "caffe" folder in the current working directory, do the following:<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">cd caffe</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">cp Makefile.config{.example,}</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;"><i>open Makefile.config in your favorite editor</i></span></blockquote><div>and change config parameters as needed. Make sure you already have CUDA set up, and if you're going to uncomment the cuDNN line, make sure you have that installed too, of course. Now, to actually build this monstrosity...</div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">mkdir build</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">cd build</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">cmake ..</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">make pycaffe</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">make runtest</span>&nbsp;</blockquote>All of these will produce a fair bit of output, especially the last two. The last one runs tests and is not actually necessary, but it is highly recommended as a way to make sure everything's gone right. Hopefully all the output produced by these commands is encouraging. If it isn't, you have a problem -- likely have an unmet dependency -- to troubleshoot. As a first step in troubleshooting, you could try running the above <span style="font-family: Courier New, Courier, monospace;">pip</span> and <span style="font-family: Courier New, Courier, monospace;">apt-get</span> commands again (possibly with <span style="font-family: Courier New, Courier, monospace;">--upgrade</span> in the case of <span style="font-family: Courier New, Courier, monospace;">pip</span>). Past that, it's all up to you. Google your error message along with "Caffe" and you can likely find some documentation on what to do.<br /><div><br /></div><div>If you managed not to hit any errors, you're now out of the woods! The hard part is over. The last step is to put Caffe in your PYTHONPATH so you can import it. I just did this the quick-and-dirty way, by putting</div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">export PYTHONPATH=/home/fish/workspace/caffe/python:$PYTHONPATH</span></blockquote><div>at the end of my .bashrc file. Obviously, you're going to want to change the path to reflect wherever you cloned Caffe into.</div><div><br /></div><div>Now, restart your shell or <span style="font-family: Courier New, Courier, monospace;">source ~/.bashrc </span><span style="font-family: inherit;">and you're set! You now have all your dependencies taken care of and can follow along with the IPython notebook in the deepdream repo linked at the top of this post. Well--almost. Your Caffe install comes with the skeletons necessary to use a few different models out of the box, but the trained models themselves aren't included with the repo because they're so large. You'll have to download them individually. To get the model used in the notebook,&nbsp;</span><span style="font-family: inherit;">navigate to your Caffe install dir, then</span><br /><div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">cd models/bvlc_googlenet/</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">wget http://dl.caffe.berkeleyvision.org/bvlc_googlenet.caffemodel</span></blockquote></div><div>This link is unlikely to change any time soon, but if it does, you can expect to find an updated link in the directory's&nbsp;<span style="font-family: Courier New, Courier, monospace;">readme.md</span>&nbsp;file. Once wget finishes up, you'll have the model you need to work through the example.&nbsp;<span style="font-family: inherit;">If you want to see the images as you work (and you probably do) then you can't run IPython this on the command line, though -- you have to start up its fancy Qt GUI console (which I didn't even know about until today). You can get this by running,</span></div></div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">ipython qtconsole</span></blockquote><div><span style="font-family: inherit;">and then you're ready to <a href="https://github.com/google/deepdream/blob/master/dream.ipynb">follow along</a>!</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Note, by the way, that if you took the bold route and compiled Caffe with GPU support, and if you have a compatible GPU, then you can run </span><span style="font-family: Courier New, Courier, monospace;">caffe.set_mode_gpu()</span><span style="font-family: inherit;">&nbsp;right away before dreaming, and it'll likely speed the process up by several orders of magnitude. There is an open pull request to integrate information on this into the Google notebook; you can find the pull request <a href="https://github.com/google/deepdream/pull/15">here</a>. It has some discussion on the topic.</span></div><div><br /><span style="font-family: inherit;">I'm having a whole lot of fun with this. Expect a follow-up post in the next few days with a bunch of cool pictures, and possibly some variations on the theme.</span></div>